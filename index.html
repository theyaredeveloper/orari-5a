<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orario 5A</title>

  <!-- INTEGRAZIONE PROGRESSIER -->
  <link rel="manifest" href="https://progressier.app/DUAaVCpXfU7fcNlRGD7S/progressier.json"/>
  <script defer src="https://progressier.app/DUAaVCpXfU7fcNlRGD7S/script.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      text-align: center;
      color: #333;
    }
    h1 {
      color: #1d3557;
      font-size: 24px;
      margin-bottom: 20px;
    }
    .popup {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 999;
    }
    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    .popup-content h2 {
      margin-top: 0;
      font-size: 26px;
    }
    button {
      background-color: #1d3557;
      color: white;
      border: none;
      padding: 14px 20px;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      margin: 10px auto;
      width: 90%;
      max-width: 300px;
      display: block;
    }
    input {
      padding: 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 90%;
      max-width: 300px;
      font-size: 16px;
      margin: 10px auto;
      display: block;
    }
    .screen { display: none; }
    .visible { display: block; }
    .suggestion {
      margin-top: 20px;
      color: #e63946;
    }
    .suggestion span {
      display: inline-block;
      background: #fff;
      border: 1px solid #ccc;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .result {
      font-size: 18px;
      margin-top: 20px;
      color: #1d3557;
    }
    p {
      font-size: 15px;
      margin: 15px 10px;
    }
  </style>
</head>
<body>

  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Benvenuti!</h2>
      <p>Inserisci il giorno e l'ora che vuoi sapere, e vedrai la materia in quell'ora.</p>
      <button onclick="closePopup()">Grazie!</button>
    </div>
  </div>

  <h1>Sito creato per gli orari della 5A</h1>

  <div class="screen visible" id="dayScreen">
    <input type="text" id="dayInput" placeholder="Scrivi il giorno es. lunedì" />
    <button onclick="nextToHour()">Avanti</button>
    <div id="autoDayBtnContainer"></div>
    <div class="suggestion" id="daySuggestion" style="display:none;">
      Stavi cercando...<br>
      <span onclick="selectDay('lunedì')">Lunedì</span>
      <span onclick="selectDay('martedì')">Martedì</span>
      <span onclick="selectDay('mercoledì')">Mercoledì</span>
      <span onclick="selectDay('giovedì')">Giovedì</span>
      <span onclick="selectDay('venerdì')">Venerdì</span>
    </div>
  </div>

  <div class="screen" id="hourScreen">
    <p>Scrivi l'ora scolastica (es. "prima", "1", "seconda") o un orario reale (es. "08:05")</p>
    <button onclick="setCurrentTime()">Inserisci l'orario reale (Italy - Rome)</button>
    <input type="text" id="hourInput" placeholder="Esempio: 08:00 o 2" />
    <button onclick="showResult()">Scopri materia</button>
    <div class="suggestion" id="hourSuggestion" style="display:none;">
      Orario non scolastico (Scuola: 08:00 - 14:00 lun-giov, 08:00 - 13:00 ven)
    </div>
    <div class="result" id="result"></div>
  </div>

  <script>
    const schedule = {
      "lunedì": ["Matematica", "Matematica", "Italiano", "Italiano", "Educazione fisica", "Musica"],
      "martedì": ["Italiano", "Italiano", "Inglese", "Potenziamento", "Arte", "Scienze"],
      "mercoledì": ["Storia", "Storia", "Matematica", "Matematica", "Arte", "Scienze"],
      "giovedì": ["Religione", "Geografia", "Italiano", "Geografia", "Inglese", "Inglese"],
      "venerdì": ["Religione", "Matematica", "Italiano", "Tecnologia", "Educazione fisica"]
    };

    let selectedDay = "";
    let errorCount = 0;

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
      loadAutoDayBtn();
    }

    function normalize(text) {
      return text.trim().toLowerCase();
    }

    function nextToHour() {
      const input = normalize(document.getElementById("dayInput").value);
      if (schedule[input]) {
        selectedDay = input;
        document.getElementById("dayScreen").classList.remove("visible");
        document.getElementById("hourScreen").classList.add("visible");
        errorCount = 0;
      } else {
        errorCount++;
        if (errorCount >= 2) {
          document.getElementById("daySuggestion").style.display = "block";
        }
      }
    }

    function selectDay(day) {
      selectedDay = day;
      document.getElementById("dayScreen").classList.remove("visible");
      document.getElementById("hourScreen").classList.add("visible");
    }

    function loadAutoDayBtn() {
      const today = new Date().toLocaleDateString("it-IT", { weekday: 'long', timeZone: "Europe/Rome" }).toLowerCase();
      if (schedule[today]) {
        const btn = document.createElement("button");
        btn.textContent = "Inserisci il giorno dal dispositivo (Italy - Rome)";
        btn.onclick = function () {
          selectDay(today);
        };
        document.getElementById("autoDayBtnContainer").appendChild(btn);
      }
    }

    function setCurrentTime() {
      const now = new Date();
      const options = { timeZone: 'Europe/Rome', hour: '2-digit', minute: '2-digit', hour12: false };
      const parts = new Intl.DateTimeFormat('it-IT', options).formatToParts(now);
      const hour = parts.find(p => p.type === 'hour').value;
      const minute = parts.find(p => p.type === 'minute').value;
      document.getElementById("hourInput").value = `${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`;
    }

    function showResult() {
      const input = normalize(document.getElementById("hourInput").value);
      const mapping = {
        "prima": 0, "seconda": 1, "terza": 2,
        "quarta": 3, "quinta": 4, "sesta": 5,
        "1": 0, "2": 1, "3": 2, "4": 3, "5": 4, "6": 5
      };
      let oraIndex = null;
      if (mapping[input] !== undefined) {
        oraIndex = mapping[input];
      } else if (/^\d{2}:\d{2}$/.test(input)) {
        const [h, m] = input.split(":").map(Number);
        const total = h * 60 + m;
        const inizio = 8 * 60;
        const fine = selectedDay === "venerdì" ? 13 * 60 : 14 * 60;
        if (total >= inizio && total < fine) {
          oraIndex = Math.floor((total - inizio) / 60);
        } else {
          document.getElementById("hourSuggestion").style.display = "block";
          document.getElementById("result").textContent = "";
          return;
        }
      }

      const maxOre = selectedDay === "venerdì" ? 5 : 6;
      if (oraIndex !== null && oraIndex < maxOre) {
        const materia = schedule[selectedDay][oraIndex];
        document.getElementById("result").textContent = `Materia: ${materia}`;
        document.getElementById("hourSuggestion").style.display = "none";
      } else {
        document.getElementById("result").textContent = "";
        document.getElementById("hourSuggestion").style.display = "block";
      }
    }
  </script>
</body>
</html>
